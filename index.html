<!DOCTYPE html>
<html>
<head>
  <title>Tokenizacja RWA</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 2rem; }
    input, button { margin: 0.3rem 0; padding: 0.4rem; width: 100%; }
    h2 { color: #2a3f54; }
    #output { margin-top: 1rem; white-space: pre-wrap; background: #f2f2f2; padding: 1rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>ğŸ¯ Tokenizacja aktywÃ³w (RWA)</h2>

  <h4>ğŸ” StwÃ³rz token</h4>
  <input type="text" id="address" placeholder="Adres wÅ‚aÅ›ciciela" />
  <input type="text" id="uri" placeholder="Token URI (np. link lub opis)" />
  <input type="number" id="value" placeholder="WartoÅ›Ä‡ aktywa (USD)" />
  <button onclick="mint()">Tokenizuj</button>

  <h4>ğŸ“¤ Przypisz udziaÅ‚y</h4>
  <input type="number" id="shareTokenId" placeholder="ID tokenu" />
  <input type="text" id="shareAddress" placeholder="Adres odbiorcy udziaÅ‚u" />
  <input type="number" id="sharePercent" placeholder="Procent udziaÅ‚u do przekazania" />
  <button onclick="assignShare()">PrzekaÅ¼ udziaÅ‚</button>

  <h4>ğŸ“„ PokaÅ¼ szczegÃ³Å‚y aktywa</h4>
  <input type="number" id="infoTokenId" placeholder="ID tokenu" />
  <button onclick="getInfo()">PokaÅ¼ dane</button>

  <div id="output"></div>

  <script>
    const contractAddress = "TU_WPISZ_ADRES_KONTRAKTU_Z_REMIX";
    const abi = [ 
      {
        "inputs": [
          { "internalType": "address", "name": "to", "type": "address" },
          { "internalType": "string", "name": "tokenURI", "type": "string" },
          { "internalType": "uint256", "name": "marketValueUSD", "type": "uint256" }
        ],
        "name": "mint",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "tokenId", "type": "uint256" },
          { "internalType": "address", "name": "to", "type": "address" },
          { "internalType": "uint256", "name": "percent", "type": "uint256" }
        ],
        "name": "assignShare",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "tokenId", "type": "uint256" }
        ],
        "name": "getAssetInfo",
        "outputs": [
          { "internalType": "string", "name": "uri", "type": "string" },
          { "internalType": "uint256", "name": "marketValueUSD", "type": "uint256" },
          { "internalType": "address[]", "name": "holders", "type": "address[]" },
          { "internalType": "uint256[]", "name": "percentages", "type": "uint256[]" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    const web3 = new Web3(window.ethereum);
    const contract = new web3.eth.Contract(abi, contractAddress);

    async function mint() {
      const to = document.getElementById("address").value;
      const uri = document.getElementById("uri").value;
      const value = document.getElementById("value").value;
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });

      contract.methods.mint(to, uri, value).send({ from: accounts[0] })
        .then(tx => show(`âœ… Token utworzony! TX: ${tx.transactionHash}`))
        .catch(err => show("âŒ BÅ‚Ä…d: " + err.message));
    }

    async function assignShare() {
      const tokenId = document.getElementById("shareTokenId").value;
      const to = document.getElementById("shareAddress").value;
      const percent = document.getElementById("sharePercent").value;
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });

      contract.methods.assignShare(tokenId, to, percent).send({ from: accounts[0] })
        .then(tx => show(`âœ… UdziaÅ‚ ${percent}% przypisany do ${to}. TX: ${tx.transactionHash}`))
        .catch(err => show("âŒ BÅ‚Ä…d: " + err.message));
    }

    async function getInfo() {
      const tokenId = document.getElementById("infoTokenId").value;

      contract.methods.getAssetInfo(tokenId).call()
        .then(data => {
          let result = `ğŸ” Informacje o tokenie #${tokenId}\n`;
          result += `ğŸ“„ URI: ${data[0]}\n`;
          result += `ğŸ’µ WartoÅ›Ä‡ rynkowa: $${data[1]}\n`;
          result += `ğŸ‘¥ UdziaÅ‚owcy:\n`;
          for (let i = 0; i < data[2].length; i++) {
            result += `- ${data[2][i]} â†’ ${data[3][i]}%\n`;
          }
          show(result);
        })
        .catch(err => show("âŒ BÅ‚Ä…d: " + err.message));
    }

    function show(msg) {
      document.getElementById("output").innerText = msg;
    }
  </script>
</body>
</html>
